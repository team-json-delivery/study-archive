# 1장: 시스템 설계 개념 둘러보기
## 1.1 트레이드 오프 논의
* 대규모 시스템을 설계하고 검토하는 능력은 직급이 올라갈수록 중요하다.
  * 시스템 설계 면접은 고위직 면접에서 더 큰 비중을 차지한다.
* IT 업계는 몇년마다 회사를 옮기는 것이 흔하다
  * 이는 면접을 여러번 거치게 됨을 의미한다.
* 시스템 설계는 완벽보다 주어진 리소스와 시간 안에서 현재와 미래의 요구사항을 가장 잘 만족시키는 시스템을 설계하는일.
  * 트레이드오프와 타협이 필요하다.
* 설계 면접은 정답을 찾는 것이 아니다.
  * 트레이드 오프를 평가하는 능력을 본다.
## 1.2 이 책을 어떻게 읽어야 할까?
* 업계 경험자, 코딩 SQL 중급 이상의 숙련도를 전제함
* 이 책은 50분 안에 자신의 아이디어, 지식, 질문을 면접관에게 명확하고 간결하게 표현하는 방법을 다룸
* 면접은 말로 하기에 뛰어난 엔지니어보다 의사소통을 잘하는 엔지니어가 유리, 그걸 다루는 책
## 1.3 이 책의 개요
* 1부는 교과서
* 2부는 예시 면접 질문 설명
* 모든 분야의 지식을 갖출것으로 기대하지 않음
  * Gzip 압축으로 CPU/메모리 리소스가 얼마나 필요할지 계산할 필요 없음
  * 파일을 보내기 전에 압축하면 네트워크 트래픽은 줄어들지만, 송신자와 수신자 모두의 CPU/메모리 리소스를 사용한다는 점은 말할 수 있어야 함
## 1.4 시스템의 다양한 서비스 확장 방식
### 1.4.1 시작: 앱의 소규모 초기 배포
* 베이글 카페에 대한 게시글을 읽고 작성할 수 있는 베이글이라는 앱 가정
* 구성요소
  * 소비자 앱 (React Web, IOS, AOS)
  * Stateless API 백엔드, GO나 자바
  * 단일 클라우드 호스트에 포함된 SQL, 데이터베이스
* 초기엔 사용자 수가 적도 요청빈도가 낮아 충분
### 1.4.2 GeoDNS를 통한 확장
* 몇달 후 아시아, 유럽, 북미에서 수십만명의 일일 활성 사용자 확보
* 각 호스트를 세계 각지의 다른 데이터 센터에 배치
* GeoDNS를 사용해 클라이언트를 가장 가까운 데이터 센터로 라우팅
### 1.4.3 캐싱 서비스 추가
* 트래픽이 많은 백엔드 엔드포인트에 Redis 로 캐시 추가
### 1.4.4 CDN
* 소스코드에 있던 정적 콘텐츠를 호스팅하기 위해 CDN을 사용하기로 함
* 사용자는 가장 빠른 데이터 센터에 접근해 다운로드
### 1.4.5 수평적 확장성과 클러스터 관리, 지속적 통합, 지속적 배포에 관한 간단한 논의
* 프론트와 백엔드는 멱등성을 가지므로 수평적으로 확장 가능
* 데브옵스 두명을 고용하여 개발과 릴리즈 방식을 변경함
#### CI/CD와 코드로서의 인프라(IaC)
* 젠킨스와 단위테스트, 통합테스트 도구를 사용한 지속적 통합/지속적 배포를 채택
* 도커를 사용해 서비스를 컨테이너화
* 쿠버네티스를 사용해 호스트 클러스터 관리
* 테라폼을 사용해 클러스터에서 실행되는 여러 서비스의 구성 관리, 벤더 종속성 줄어듦
#### 점진적 롤아웃과 롤백
* 1, 5%, 10%, 25%, 100% 까지 점진적 배포, 문제시 롤백
#### 실험
* 모든 사용자에게 새 기능을 한번에 적용하는 대신 점진적으로 사용자 비율을 늘려가며 롤아웃 가능
* CD와 실험을 통해 새로운 배포와 기능에 대한 피드백 주기 단축
### 1.4.6 기능적 분할과 교차 관심사의 중앙 집중화
#### 공유 서비스
* iOS 5명, 안드로이드 5명, 프론트 10명, 백엔드 100명으로 확장하고 데이터 사이언스 팀을 만들게됨
* 수평적 확장 외에도 기능적 분할을 사용함
  * ELK로 구성된 로깅 서비스 추가
  * 집킨으로 분산 추적 시스템 추가
  * 모니터링과 경보 서비스 추가
  * API 게이트웨이 추가
#### API 게이트웨이
* 여러 서비스에서 공통 기능 제공
  * 인가와 인증
  * 요청 수준의 로깅, 모니터링, 경보
  * 속도 제한
  * 요금 청구
  * 분석
* API 게이트웨이는 지연시간이 추가되고 대규모 호스트 클러스터가 필요한 단점
* 해결책은 사이드카 패턴 (서비스 메시)
  * 이스티오 같은 서비스 메시 프레임워크 사용
  * 각 Pod는 사이드카 포함
    * 서비스 요청과 응답이 사이드카를 통해 라우팅
  * 서비스와 같은 호스트에 있어서 네트워크 지연이 없음
  * 그러나 사이드카는 시스템 리소스 소비
#### 사이드카 없는 서비스 메시 - 최신 기술
내부 서비스간 통신을 포함하는 시스템은, 사이드카 프록시 로직을 호스트에 요청을 보내는 클라이언트 호스트에 배치해 복잡성을 줄일 수 있음
#### 명령 쿼리 책임 분리 (CQRS)
CQRS는 복잡성을 증가시키지만 지연시간이 낮고 확장성이 좋으며 유지보수와 사용이 더 쉬움
### 1.4.7 ETL
* 특정 데이터 처리 요청은 동기식일 필요 없다
* 사용자가 자주 학습한 상위 10개 단어 표시는 미리 배치로 처리
### 1.4.8 기타 필요 서비스
* 고객/외부 사용자 자격 증명 관리
* 다양한 기술과 기법을 사용하는 여러 공유 스토리지 서비스 개발/유지보수
* 비동기 처리
* 머신러닝을 위한 노트북 서비스
* 검색창 서비스 (자동완성)
* 프라이버시 준수 서비스와 팀
* 사기 탐지
### 1.4.9 클라우드 vs 베어메탈
* 클라우드 업체는 CI/CD, 로깅, 모니터링, 경보, 캐시, SQL, NoSQL을 포함한 많은 서비스 제공
* 처음부터 베어메탈을 선택했다면 모두 직접 설정하고 유지
* 회사가 성공한사면 베어메탈을 고려할 규모의 경제
* 설정의 단순성
* 비용이점
* 더 나은 지원과 품질 제공
* 업그레이드 비용
* 단점 : 벤더 종속성, 멀티 클라우드 전략을 채택 하기도함
### 1.4.10 서버리스
특정 엔드포인트를 자주 사용하지 않고 약간 느려도 되면 AWS 람다 고려
### 1.4.11 결론: 백엔드 서비스 확장
클러스터 크기를 조정하고 GeoDNS를 사용해 간단히 확장 가능
